
<div class="row no-gutters">
  <div class="col left-panel pt-2">   
    <div class="groups">
      <div class="mb-2" *ngFor="let group of groups; let i = index">
        <div *ngIf="editGroupIndex === i; else groupDisplay">
          <form [formGroup]="editGroupForm">
            <div class="input-group input-group-sm input-group-sm-custom mb-2">
              <input
                id="edit-group-name"
                class="form-control form-control-sm"
                placeholder="Gruppenname"
                formControlName="groupName"
              />
              <button class="btn btn-outline-success" type="button" (click)="saveEditedGroup()">
                <i class="fa-regular fa-floppy-disk"></i>
              </button>
              <button class="btn btn-outline-danger" type="button" (click)="cancelEditGroup()">
                <i class="fa-solid fa-xmark"></i>
              </button> 
            </div>
            <div 
                class="invalid-feedback custom-invalid-feedback"
                *ngIf="editGroupForm.get('groupName')?.errors?.['required']"
            >
              Gruppenname ist erforderlich.
            </div>
          </form>
          
        </div>
        <ng-template #groupDisplay>
          <span class="group-name">
            <button class="btn-text-style" (click)="toggleGroupAttributes(i)">{{ group.name }} </button>
            <button class="btn-text-style green" (click)="editGroup(i)"><i class="fa-regular fa-pen-to-square"></i></button>
            <button class="btn-text-style red" (click)="removeGroup(i)">
              <i class="fa-regular fa-trash-can"></i>
            </button>
            <button class="btn-text-style blue" (click)="toggleGroupAttributes(i)">
              <i class="fa-solid" [ngClass]="group.hidden ? 'fa-eye-slash' : 'fa-eye'"></i>
            </button>
          </span>
        </ng-template>
        <div *ngIf="!group.hidden" cdkDropList [id]="getGroupDropListId(i)" [cdkDropListData]="group.attributes"
             [cdkDropListConnectedTo]="connectedDropLists" 
             class="attr-group-list" (cdkDropListDropped)="drop($event, group)">
          <div class="attr-group-box" *ngFor="let attribute of group.attributes" cdkDrag>
            <span  class="attr-name col-3">{{attribute.name}}</span>

            
            <span  class="attr-value col-3">
              <input *ngIf="attribute.attribute_type != 'Dropdown'" type="text" class="form-control form-control-sm">
              <select *ngIf="attribute.attribute_type == 'Dropdown'" class="form-select form-select-sm" id="networkoperator">
                <option value="1">Vodafone</option>
                <option value="2">T-mobile</option>
                <option value="3">O2 Telefonica</option>
              </select>
            </span>
            <span class="attr-unit col">
              {{attribute.unit}}
            </span>

            <span *ngIf="attribute.is_frontend_visible" class="attr-frontend_visible green">
              <i class="far fa-eye"></i>
            </span>
            <span *ngIf="!attribute.is_frontend_visible" class="attr-frontend_visible red">
              <i class="fas fa-eye-slash"></i>
            </span>
            <button class="btn-text-style red" (click)="removeAttribute(group, attribute)">
              <i class="fa-regular fa-trash-can"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
    <form [formGroup]="newGroupForm" *ngIf="addNewGroup">
      <div class="mb-3">
        <label class="form-label custom-label-sm" for="group-name">Gruppenname</label>
        <div class="input-group input-group-sm input-group-sm-custom">
          <input
            id="group-name"
            class="form-control form-control-sm"
            placeholder="Gruppenname"
            formControlName="groupName"
          />
          <button class="btn btn-outline-success" type="button" (click)="saveNewGroup()">
            <i class="fa-regular fa-floppy-disk"></i>
          </button>
          <button class="btn btn-outline-danger" type="button" (click)="cancelNewGroup()">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
        <div 
            class="invalid-feedback custom-invalid-feedback"
            *ngIf="editGroupForm.get('groupName')?.errors?.['required']"
        >
          Gruppenname ist erforderlich.
        </div>
        
      </div>
    </form>
    <button class="btn-text-style" (click)="addNewGroupName()">
      <i class="fa-solid fa-circle-plus"></i> Neue Gruppe
    </button>
  </div>
  <div class="col-5 right-panel pt-2">
    <div cdkDropList [id]="tariffDropListId" [cdkDropListData]="tariffAttributes"
         [cdkDropListConnectedTo]="connectedDropLists" class="attr-group-list" 
         (cdkDropListDropped)="drop($event)" [cdkDropListEnterPredicate]="canDropToTariffList">
      <div class="attr-group-box" *ngFor="let attribute of tariffAttributes" cdkDrag>
        <!-- {{ attribute }} -->
        <span class="attr-kennung col">{{attribute.code}}</span>
        <span class="attr-name col">{{attribute.name}}</span>
        <span *ngIf="attribute.is_frontend_visible" class="attr-frontend_visible green">
          <i class="far fa-eye"></i>
        </span>
        <span *ngIf="!attribute.is_frontend_visible" class="attr-frontend_visible red">
          <i class="fas fa-eye-slash"></i>
        </span>
      </div>
    </div>
  </div>
</div>

<!-- <div class="attr-group-box cdk-drag ng-star-inserted">
  <span class="attr-kennung">highspeed_data</span>
  <span class="attr-name">Highspeed-Data(gesamt)</span>
  <span class="attr-frontend_visible green ng-star-inserted">
    <i _ngcontent-qdo-c44="" class="far fa-eye"></i>
  </span>
</div> -->